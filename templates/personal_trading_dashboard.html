<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Personal Trading Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Ensure Chart.js is loaded before using it
        if (typeof Chart === 'undefined') {
            document.write('<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"><\/script>');
        }
    </script>
    <style>
        /* Professional Color Palette - Teal Blue & Charcoal Gray */
        :root {
            /* Comfortable Teal-Blue Background - softened for eye comfort */
            --primary-bg: linear-gradient(140deg, #0f172a 0%, #122438 45%, #0c1b2b 100%);
            --secondary-bg: linear-gradient(140deg, #17364a 0%, #1f4a63 100%);
            /* Muted Charcoal for text and elements */
            --charcoal-dark: #1f2937;
            --charcoal-medium: #334155;
            --charcoal-light: #475569;
            /* Softer Teal/Cyan Accents */
            --accent-teal: #22c5b7;
            --accent-teal-dark: #199f93;
            --accent-teal-light: #6ee7d1;
            --accent-cyan: #38bdf8;
            /* Status Colors */
            --accent-green: #34d399;
            --accent-red: #f87171;
            --accent-yellow: #fbbf24;
            --accent-purple: #a78bfa;
            /* Glass Effects - softer and less glowy */
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(34, 197, 183, 0.18);
            /* Text Colors */
            --text-primary: #f7fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #9ca3af;
            /* Shadows with gentle teal glow */
            --shadow-primary: 0 6px 26px rgba(0, 0, 0, 0.22);
            --shadow-glow: 0 0 18px rgba(34, 197, 183, 0.24);
        }

        .gradient-bg {
            background: var(--primary-bg);
            background-attachment: fixed;
        }

        .secondary-gradient {
            background: var(--secondary-bg);
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-primary), var(--shadow-glow);
            border-color: rgba(20, 184, 166, 0.4);
        }

        .glow-effect {
            box-shadow: var(--shadow-primary), var(--shadow-glow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glow-effect:hover {
            box-shadow: var(--shadow-primary), 0 0 35px rgba(20, 184, 166, 0.5);
            transform: translateY(-3px);
        }

        /* Professional Text Colors */
        .profit-text {
            color: var(--accent-green);
            font-weight: 600;
        }
        .loss-text {
            color: var(--accent-red);
            font-weight: 600;
        }
        .neutral-text {
            color: var(--text-muted);
        }

        /* Market Category Styles with Smooth Transitions - Teal Theme */
        .market-asian {
            border-left: 4px solid var(--accent-teal-light);
            transition: all 0.3s ease;
        }
        .market-major {
            border-left: 4px solid var(--accent-teal);
            transition: all 0.3s ease;
        }
        .market-emerging {
            border-left: 4px solid var(--accent-cyan);
            transition: all 0.3s ease;
        }
        .market-crypto {
            border-left: 4px solid var(--accent-teal-dark);
            transition: all 0.3s ease;
        }

        /* Signal Styles with Professional Gradients */
        .signal-buy {
            background: linear-gradient(135deg, var(--accent-green), #059669);
            color: white;
            transition: all 0.3s ease;
        }
        .signal-sell {
            background: linear-gradient(135deg, var(--accent-red), #dc2626);
            color: white;
            transition: all 0.3s ease;
        }
        .signal-hold {
            background: linear-gradient(135deg, var(--accent-yellow), #d97706);
            color: white;
            transition: all 0.3s ease;
        }

        /* Smooth Animations */
        .animate-fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .animate-slide-up {
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        /* Professional Loading Animation */
        .loading-shimmer {
            background: linear-gradient(90deg,
                transparent 25%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        /* Button Hover Effects - Teal Theme */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan));
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(20, 184, 166, 0.4);
            color: white;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(20, 184, 166, 0.5);
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-teal));
        }

        /* Table Row Hover */
        .table-row {
            transition: all 0.2s ease;
        }

        .table-row:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: scale(1.01);
        }

        /* Metric Cards Animation */
        .metric-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metric-card:hover {
            transform: translateY(-4px);
        }

        /* Keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Professional Typography - Teal Gradient */
        .text-gradient {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Status Indicators */
        .status-online {
            position: relative;
        }

        .status-online::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 8px;
            background: var(--accent-teal);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Loading States */
        .loading-skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        /* Custom Scrollbar - Teal Theme */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(20, 184, 166, 0.6);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(20, 184, 166, 0.8);
        }

        /* Teal Color Classes for Tailwind */
        .text-accent-teal { color: var(--accent-teal); }
        .text-accent-cyan { color: var(--accent-cyan); }
        .text-accent-purple { color: var(--accent-purple); }
        .bg-accent-teal { background-color: var(--accent-teal); }
        .bg-accent-cyan { background-color: var(--accent-cyan); }
        .bg-accent-purple { background-color: var(--accent-purple); }
        .border-accent-teal { border-color: var(--accent-teal); }
        .border-accent-cyan { border-color: var(--accent-cyan); }
        .border-accent-purple { border-color: var(--accent-purple); }
        .text-charcoal-dark { color: var(--charcoal-dark); }
        .bg-charcoal-dark { background-color: var(--charcoal-dark); }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- Authentication Screen -->
    <div id="auth-screen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50" style="display: flex;">
        <div class="glass-card rounded-2xl p-8 w-full max-w-md animate-fade-in">
            <div class="text-center mb-8">
                <div class="w-20 h-20 secondary-gradient rounded-2xl flex items-center justify-center mx-auto mb-4 animate-float">
                    <i data-lucide="shield" class="w-10 h-10 text-white"></i>
                </div>
                <h2 class="text-3xl font-bold text-gradient mb-2">Secure Access</h2>
                <p class="text-white/70">Enter your credentials to access your trading dashboard</p>
            </div>

            <form id="login-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-white/80 mb-2">Username</label>
                    <input 
                        type="text" 
                        id="username" 
                        required 
                        class="w-full glass-card border-0 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:ring-2 focus:ring-accent-teal focus:outline-none"
                        placeholder="Enter your username"
                        autocomplete="username"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-white/80 mb-2">Password</label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="password" 
                            required 
                            class="w-full glass-card border-0 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:ring-2 focus:ring-accent-teal focus:outline-none pr-12"
                            placeholder="Enter your password"
                            autocomplete="current-password"
                        >
                        <button 
                            type="button" 
                            onclick="togglePasswordVisibility()" 
                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-white/60 hover:text-white"
                        >
                            <i data-lucide="eye" id="password-eye" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input 
                            type="checkbox" 
                            id="remember-me" 
                            class="w-4 h-4 rounded glass-card border-white/20 text-accent-teal focus:ring-accent-teal"
                        >
                        <span class="ml-2 text-sm text-white/70">Remember me</span>
                    </label>
                    <a href="#" onclick="showForgotPassword()" class="text-sm text-accent-teal hover:text-accent-teal-light">Forgot password?</a>
                </div>

                <div id="login-error" class="hidden p-3 glass-card rounded-lg bg-red-500/20 border border-red-500/30">
                    <p class="text-sm text-red-400" id="error-message"></p>
                </div>

                <button 
                    type="submit" 
                    class="w-full btn-primary py-3 rounded-lg text-base font-semibold flex items-center justify-center space-x-2"
                >
                    <i data-lucide="log-in" class="w-5 h-5"></i>
                    <span>Sign In</span>
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-sm text-white/60">
                    Don't have an account? 
                    <a href="#" onclick="showRegisterForm()" class="text-accent-teal hover:text-accent-teal-light font-medium">Register</a>
                </p>
            </div>

            <!-- Security Notice -->
            <div class="mt-6 p-4 glass-card rounded-lg bg-blue-500/10 border border-blue-500/20">
                <div class="flex items-start">
                    <i data-lucide="shield-check" class="w-5 h-5 text-accent-teal mr-2 mt-0.5"></i>
                    <div>
                        <p class="text-xs text-white/80 font-medium">Secure Connection</p>
                        <p class="text-xs text-white/60 mt-1">Your data is encrypted and protected</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass-card border-b border-white/10 animate-fade-in">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <div class="w-12 h-12 secondary-gradient rounded-xl flex items-center justify-center mr-4 animate-float glow-effect">
                            <i data-lucide="trending-up" class="w-7 h-7 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gradient">My Trading Dashboard</h1>
                            <p class="text-sm text-white/70">Professional Performance & Analytics</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-2 glass-card px-3 py-2 rounded-lg">
                        <i data-lucide="clock" class="w-4 h-4 text-accent-teal"></i>
                        <span class="text-sm font-medium" id="current-time">Loading...</span>
                    </div>
                    <div class="flex items-center space-x-3 glass-card px-4 py-2 rounded-lg status-online">
                        <div class="w-3 h-3 bg-accent-teal rounded-full animate-pulse-slow"></div>
                        <span class="text-sm font-medium text-accent-teal">Live Data</span>
                    </div>
                    <div class="flex items-center space-x-2 glass-card px-3 py-2 rounded-lg" title="Secure Session Active">
                        <i data-lucide="shield-check" class="w-4 h-4 text-accent-green"></i>
                        <span class="text-sm font-medium text-accent-green">Secure</span>
                    </div>
                    <div class="relative group">
                        <div class="w-10 h-10 secondary-gradient rounded-full flex items-center justify-center glow-effect cursor-pointer" id="user-menu-btn">
                            <i data-lucide="user" class="w-5 h-5 text-white"></i>
                        </div>
                        <!-- User Dropdown Menu -->
                        <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 glass-card rounded-lg shadow-lg z-50">
                            <div class="p-2">
                                <div class="px-3 py-2 border-b border-white/10">
                                    <p class="text-sm font-medium text-white" id="user-display-name">User</p>
                                    <p class="text-xs text-white/60" id="user-email">user@example.com</p>
                                </div>
                                <a href="#" onclick="showProfile()" class="block px-3 py-2 text-sm text-white/80 hover:bg-white/10 rounded">
                                    <i data-lucide="user" class="w-4 h-4 inline mr-2"></i>
                                    Profile Settings
                                </a>
                                <a href="#" onclick="showSecuritySettings()" class="block px-3 py-2 text-sm text-white/80 hover:bg-white/10 rounded">
                                    <i data-lucide="shield" class="w-4 h-4 inline mr-2"></i>
                                    Security
                                </a>
                                <a href="#" onclick="logout()" class="block px-3 py-2 text-sm text-red-400 hover:bg-red-500/10 rounded">
                                    <i data-lucide="log-out" class="w-4 h-4 inline mr-2"></i>
                                    Sign Out
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50" style="display: none;">
        <div class="text-center">
            <div class="w-20 h-20 secondary-gradient rounded-2xl flex items-center justify-center mb-6 animate-float">
                <i data-lucide="trending-up" class="w-10 h-10 text-white animate-pulse"></i>
            </div>
            <h2 class="text-3xl font-bold text-gradient mb-4">My Trading Dashboard</h2>
            <div class="flex items-center space-x-2 mb-4">
                <div class="loading-shimmer h-2 rounded-full flex-1"></div>
                <span class="text-white/70">Loading...</span>
            </div>
            <p class="text-white/60">Initializing professional trading interface</p>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" id="main-content" style="display: none;">
        <!-- Personal Trading Overview -->
        <div class="mb-8 animate-fade-in">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h2 class="text-4xl font-bold mb-3 text-gradient">ðŸ“Š My Trading Performance</h2>
                    <p class="text-lg text-white/80">Professional real-time portfolio tracking and analytics</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="glass-card rounded-xl px-6 py-3 animate-slide-up">
                        <div class="text-xs text-white/60 uppercase tracking-wide">Last Update</div>
                        <div class="text-sm font-semibold text-accent-teal" id="last-update">Just now</div>
                    </div>
                    <button class="btn-primary px-6 py-3 rounded-xl text-sm font-semibold flex items-center space-x-2" onclick="refreshAllData()">
                        <i data-lucide="refresh-cw" class="w-4 h-4 animate-spin" id="refresh-icon"></i>
                        <span>Refresh Data</span>
                    </button>
                </div>
            </div>

            <!-- Key Portfolio Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass-card rounded-xl p-6 metric-card animate-fade-in" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/70 text-sm font-medium uppercase tracking-wide">Portfolio Balance</p>
                            <p class="text-3xl font-bold text-accent-green mt-2" id="portfolio-balance">$25,430.75</p>
                            <p class="text-sm text-accent-green mt-1 font-medium" id="balance-change">+2.4% (+$620.50)</p>
                        </div>
                        <div class="w-14 h-14 secondary-gradient rounded-xl flex items-center justify-center animate-float">
                            <i data-lucide="dollar-sign" class="w-7 h-7 text-accent-green"></i>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-xl p-6 metric-card animate-fade-in" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/70 text-sm font-medium uppercase tracking-wide">Today's P&L</p>
                            <p class="text-3xl font-bold text-white mt-2" id="today-pnl">+$145.20</p>
                            <p class="text-sm text-accent-green mt-1 font-medium" id="pnl-change">+1.8% from yesterday</p>
                        </div>
                        <div class="w-14 h-14 secondary-gradient rounded-xl flex items-center justify-center animate-float" style="animation-delay: 1s">
                            <i data-lucide="trending-up" class="w-7 h-7 text-accent-teal"></i>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-xl p-6 metric-card animate-fade-in" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/70 text-sm font-medium uppercase tracking-wide">Active Positions</p>
                            <p class="text-3xl font-bold text-accent-purple mt-2" id="active-positions">3</p>
                            <p class="text-sm text-white/70 mt-1">2 profitable, 1 breakeven</p>
                        </div>
                        <div class="w-14 h-14 secondary-gradient rounded-xl flex items-center justify-center animate-float" style="animation-delay: 2s">
                            <i data-lucide="activity" class="w-7 h-7 text-accent-purple"></i>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-xl p-6 metric-card animate-fade-in" style="animation-delay: 0.4s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/70 text-sm font-medium uppercase tracking-wide">Win Rate</p>
                            <p class="text-3xl font-bold text-accent-yellow mt-2" id="win-rate">73.2%</p>
                            <p class="text-sm text-white/70 mt-1">127 wins / 47 losses</p>
                        </div>
                        <div class="w-14 h-14 secondary-gradient rounded-xl flex items-center justify-center animate-float" style="animation-delay: 3s">
                            <i data-lucide="target" class="w-7 h-7 text-accent-yellow"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Live Signals & Current Positions -->
            <div class="lg:col-span-2 space-y-8">
                    <!-- Current Positions -->
                <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.5s">
                    <h3 class="text-2xl font-bold mb-6 flex items-center">
                        <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="briefcase" class="w-5 h-5 text-accent-teal"></i>
                        </div>
                        Current Positions
                    </h3>
                    <div class="space-y-4" id="current-positions">
                        <!-- Positions will be loaded here -->
                    </div>
                </div>

                <!-- Live Trading Signals -->
                <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.6s">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold flex items-center">
                            <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="zap" class="w-5 h-5 text-accent-yellow"></i>
                            </div>
                            Live Trading Signals
                        </h3>
                        <select id="signal-filter" class="glass-card border-0 rounded-lg px-4 py-2 text-sm font-medium focus:ring-2 focus:ring-accent-teal focus:outline-none">
                            <option value="all">All Signals</option>
                            <option value="buy">Buy Only</option>
                            <option value="sell">Sell Only</option>
                            <option value="high-confidence">High Confidence (80%+)</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="live-signals">
                        <!-- Signals will be loaded here -->
                    </div>
                </div>

                <!-- Trading Records -->
                <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.7s">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold flex items-center">
                            <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="history" class="w-5 h-5 text-accent-green"></i>
                            </div>
                            Trading Records & Statistics
                        </h3>
                        <div class="flex items-center space-x-3">
                            <select id="records-filter" class="glass-card border-0 rounded-lg px-4 py-2 text-sm font-medium focus:ring-2 focus:ring-accent-green focus:outline-none">
                                <option value="all">All Trades</option>
                                <option value="wins">Winning Trades</option>
                                <option value="losses">Losing Trades</option>
                                <option value="last-30">Last 30 Days</option>
                                <option value="last-7">Last 7 Days</option>
                            </select>
                            <button class="btn-primary px-4 py-2 rounded-lg text-sm font-medium" onclick="exportRecords()">
                                <i data-lucide="download" class="w-4 h-4 inline mr-2"></i>
                                Export CSV
                            </button>
                        </div>
                    </div>

                    <!-- Trading Statistics -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="text-center">
                            <p class="text-2xl font-bold text-green-400" id="total-trades">174</p>
                            <p class="text-xs text-white/60">Total Trades</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-accent-teal" id="avg-trade-size">$1,250</p>
                            <p class="text-xs text-white/60">Avg Trade Size</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-purple-400" id="best-trade">+$890</p>
                            <p class="text-xs text-white/60">Best Trade</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-red-400" id="worst-trade">-$420</p>
                            <p class="text-xs text-white/60">Worst Trade</p>
                        </div>
                    </div>

                    <!-- Trading Records Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-white/20">
                                    <th class="text-left py-2">Asset</th>
                                    <th class="text-left py-2">Direction</th>
                                    <th class="text-left py-2">Strategy</th>
                                    <th class="text-right py-2">Entry</th>
                                    <th class="text-right py-2">Exit</th>
                                    <th class="text-right py-2">P&L</th>
                                    <th class="text-right py-2">Pips</th>
                                    <th class="text-right py-2">Duration</th>
                                    <th class="text-right py-2">Date</th>
                                </tr>
                            </thead>
                            <tbody id="trading-records">
                                <!-- Records will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="flex items-center justify-between mt-4">
                        <p class="text-sm text-white/60" id="records-info">Showing 1-10 of 174 trades</p>
                        <div class="flex items-center space-x-2">
                            <button class="bg-black/20 hover:bg-black/30 px-3 py-1 rounded text-sm" id="prev-page" disabled>Previous</button>
                            <span class="text-sm" id="page-info">Page 1 of 18</span>
                            <button class="bg-black/20 hover:bg-black/30 px-3 py-1 rounded text-sm" id="next-page">Next</button>
                        </div>
                    </div>
                </div>
            </div>

                <!-- Right Column: Analytics & Charts -->
                <div class="space-y-8">
                    <!-- Performance Chart -->
                    <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.8s">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="bar-chart-3" class="w-5 h-5 text-accent-purple"></i>
                            </div>
                            Performance Chart
                        </h3>
                        <div class="relative">
                            <canvas id="performance-chart" width="300" height="200" class="rounded-lg"></canvas>
                        </div>
                    </div>

                    <!-- Market Overview -->
                    <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.9s">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="globe" class="w-5 h-5 text-accent-teal"></i>
                            </div>
                            Market Overview
                        </h3>
                        <div class="space-y-3" id="market-overview">
                            <!-- Market data will be loaded here -->
                        </div>
                    </div>

                    <!-- AI Insights -->
                    <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 1.0s">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="brain" class="w-5 h-5 text-accent-green"></i>
                            </div>
                            AI Insights
                        </h3>
                        <div class="space-y-3" id="ai-insights">
                            <!-- AI insights will be loaded here -->
                        </div>
                    </div>

                    <!-- Risk Metrics -->
                    <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 1.1s">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="shield" class="w-5 h-5 text-accent-red"></i>
                            </div>
                            Risk Metrics
                        </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-white/70">Max Drawdown</span>
                            <span class="text-red-400 font-semibold" id="max-drawdown">-8.2%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-white/70">Sharpe Ratio</span>
                            <span class="text-accent-teal font-semibold" id="sharpe-ratio">1.8</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-white/70">Daily VaR (95%)</span>
                            <span class="text-yellow-400 font-semibold" id="var-95">-$320.50</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-white/70">Position Limit</span>
                            <span class="text-green-400 font-semibold" id="position-limit">3/5 active</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons with error handling
        try {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        } catch (error) {
            console.error('Error initializing Lucide icons:', error);
        }

        // ============================================
        // AUTHENTICATION & SECURITY SYSTEM
        // ============================================

        // Session timeout (30 minutes)
        const SESSION_TIMEOUT = 30 * 60 * 1000;
        let sessionTimer = null;
        let inactivityTimer = null;

        // Simple password hashing (for demo - use proper hashing in production)
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Encrypt sensitive data
        function encryptData(data, key) {
            try {
                const encrypted = btoa(JSON.stringify(data));
                return encrypted;
            } catch (e) {
                console.error('Encryption error:', e);
                return data;
            }
        }

        // Decrypt sensitive data
        function decryptData(encryptedData, key) {
            try {
                const decrypted = JSON.parse(atob(encryptedData));
                return decrypted;
            } catch (e) {
                console.error('Decryption error:', e);
                return encryptedData;
            }
        }

        // Store sensitive trading data securely
        function storeSecureData(key, data) {
            if (!isAuthenticated()) return;
            
            try {
                const session = JSON.parse(localStorage.getItem('trading_session'));
                const encrypted = encryptData(data, session.username);
                localStorage.setItem(`secure_${key}`, encrypted);
            } catch (e) {
                console.error('Error storing secure data:', e);
            }
        }

        // Retrieve sensitive trading data securely
        function getSecureData(key) {
            if (!isAuthenticated()) return null;
            
            try {
                const encrypted = localStorage.getItem(`secure_${key}`);
                if (!encrypted) return null;
                return decryptData(encrypted, '');
            } catch (e) {
                console.error('Error retrieving secure data:', e);
                return null;
            }
        }

        // Clear all sensitive data on logout
        function clearSecureData() {
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('secure_')) {
                    localStorage.removeItem(key);
                }
            });
        }

        // Data protection: Mask sensitive information
        function maskSensitiveData(data, type = 'default') {
            if (!data) return '';
            
            switch (type) {
                case 'account':
                    return '****' + data.slice(-4);
                case 'email':
                    const [name, domain] = data.split('@');
                    return name.slice(0, 2) + '***@' + domain;
                case 'full':
                    return '*'.repeat(data.length);
                default:
                    return data;
            }
        }

        // Check if user is authenticated
        function isAuthenticated() {
            const session = localStorage.getItem('trading_session');
            if (!session) return false;

            try {
                const sessionData = JSON.parse(session);
                const now = Date.now();
                
                // Check if session expired
                if (now - sessionData.timestamp > SESSION_TIMEOUT) {
                    localStorage.removeItem('trading_session');
                    return false;
                }

                return true;
            } catch (e) {
                return false;
            }
        }

        // Create session
        function createSession(username, rememberMe = false) {
            const sessionData = {
                username: username,
                timestamp: Date.now(),
                rememberMe: rememberMe
            };
            localStorage.setItem('trading_session', JSON.stringify(sessionData));
            
            // Store user info
            const userInfo = {
                username: username,
                email: username + '@trading.com',
                loginTime: new Date().toISOString()
            };
            localStorage.setItem('user_info', JSON.stringify(userInfo));

            // Start session timer
            startSessionTimer();
            startInactivityTimer();
        }

        // Start session timer
        function startSessionTimer() {
            if (sessionTimer) clearTimeout(sessionTimer);
            sessionTimer = setTimeout(() => {
                alert('Your session has expired. Please login again.');
                logout();
            }, SESSION_TIMEOUT);
        }

        // Start inactivity timer
        function startInactivityTimer() {
            if (inactivityTimer) clearTimeout(inactivityTimer);
            
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
            const resetTimer = () => {
                if (inactivityTimer) clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    // Warn user after 5 minutes of inactivity
                    if (confirm('You have been inactive. Do you want to stay logged in?')) {
                        startInactivityTimer();
                    } else {
                        logout();
                    }
                }, 5 * 60 * 1000); // 5 minutes
            };

            events.forEach(event => {
                document.addEventListener(event, resetTimer, true);
            });
            resetTimer();
        }

        // Handle login
        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            const errorDiv = document.getElementById('login-error');
            const errorMessage = document.getElementById('error-message');

            // Hide previous errors
            errorDiv.classList.add('hidden');

            // Validate input
            if (!username || !password) {
                errorMessage.textContent = 'Please enter both username and password';
                errorDiv.classList.remove('hidden');
                return;
            }

            // Hash password
            const hashedPassword = await hashPassword(password);

            // Check credentials (in production, this would be a server call)
            // For demo: default credentials are admin/admin
            const storedHash = localStorage.getItem('user_password_hash');
            const defaultHash = await hashPassword('admin'); // Default password

            let isValid = false;
            if (storedHash) {
                isValid = hashedPassword === storedHash && username === localStorage.getItem('user_username');
            } else {
                // First time login - accept admin/admin
                isValid = username === 'admin' && hashedPassword === defaultHash;
                if (isValid) {
                    localStorage.setItem('user_password_hash', hashedPassword);
                    localStorage.setItem('user_username', username);
                }
            }

            if (isValid) {
                // Create session
                createSession(username, rememberMe);
                
                // Hide auth screen
                document.getElementById('auth-screen').style.display = 'none';
                
                // Show dashboard
                document.getElementById('main-content').style.display = 'block';
                
                // Update user display
                updateUserDisplay(username);
                
                // Initialize dashboard
                initializeDashboard();
            } else {
                errorMessage.textContent = 'Invalid username or password';
                errorDiv.classList.remove('hidden');
            }
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to sign out? All sensitive data will be cleared.')) {
                // Clear session
                localStorage.removeItem('trading_session');
                if (sessionTimer) clearTimeout(sessionTimer);
                if (inactivityTimer) clearTimeout(inactivityTimer);
                
                // Clear all secure data
                clearSecureData();
                
                // Hide dashboard
                document.getElementById('main-content').style.display = 'none';
                
                // Show auth screen
                document.getElementById('auth-screen').style.display = 'flex';
                
                // Clear form
                document.getElementById('login-form').reset();
                
                // Clear user menu
                document.getElementById('user-menu').classList.add('hidden');
            }
        }

        // Update user display
        function updateUserDisplay(username) {
            const userInfo = JSON.parse(localStorage.getItem('user_info') || '{}');
            document.getElementById('user-display-name').textContent = username || 'User';
            document.getElementById('user-email').textContent = userInfo.email || username + '@trading.com';
        }

        // Toggle password visibility
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('password-eye');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.setAttribute('data-lucide', 'eye-off');
            } else {
                passwordInput.type = 'password';
                eyeIcon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        }

        // Show register form (placeholder)
        function showRegisterForm() {
            alert('Registration feature coming soon. For now, use default credentials:\nUsername: admin\nPassword: admin');
        }

        // Show forgot password (placeholder)
        function showForgotPassword() {
            alert('Password recovery feature coming soon. Please contact support.');
        }

        // Show profile settings
        function showProfile() {
            document.getElementById('user-menu').classList.add('hidden');
            alert('Profile settings coming soon!');
        }

        // Show security settings
        function showSecuritySettings() {
            document.getElementById('user-menu').classList.add('hidden');
            const newPassword = prompt('Enter new password (min 8 characters):');
            if (newPassword && newPassword.length >= 8) {
                hashPassword(newPassword).then(hash => {
                    localStorage.setItem('user_password_hash', hash);
                    alert('Password updated successfully!');
                });
            } else if (newPassword) {
                alert('Password must be at least 8 characters long.');
            }
        }

        // Toggle user menu
        document.addEventListener('DOMContentLoaded', () => {
            const userMenuBtn = document.getElementById('user-menu-btn');
            const userMenu = document.getElementById('user-menu');
            
            if (userMenuBtn && userMenu) {
                userMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userMenu.classList.toggle('hidden');
                });

                // Close menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                        userMenu.classList.add('hidden');
                    }
                });
            }
        });

        // Check authentication on page load
        function checkAuthentication() {
            // Hide loading screen first
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
            
            try {
                if (isAuthenticated()) {
                    const session = JSON.parse(localStorage.getItem('trading_session'));
                    const authScreen = document.getElementById('auth-screen');
                    const mainContent = document.getElementById('main-content');
                    
                    if (authScreen) authScreen.style.display = 'none';
                    if (mainContent) {
                        mainContent.style.display = 'block';
                        // Initialize dashboard immediately
                        setTimeout(() => initializeDashboard(), 100);
                    }
                    
                    if (session && session.username) {
                        updateUserDisplay(session.username);
                    }
                    startSessionTimer();
                    startInactivityTimer();
                } else {
                    const authScreen = document.getElementById('auth-screen');
                    const mainContent = document.getElementById('main-content');
                    
                    if (authScreen) authScreen.style.display = 'flex';
                    if (mainContent) mainContent.style.display = 'none';
                }
            } catch (error) {
                console.error('Error in checkAuthentication:', error);
                // Show auth screen on error
                const authScreen = document.getElementById('auth-screen');
                const mainContent = document.getElementById('main-content');
                if (authScreen) authScreen.style.display = 'flex';
                if (mainContent) mainContent.style.display = 'none';
            }
        }

        // Initialize authentication
        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', checkAuthentication);
        } else {
            checkAuthentication();
        }

        // Attach login form handler
        document.addEventListener('DOMContentLoaded', () => {
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            // Initialize icons for auth screen
            try {
                lucide.createIcons();
            } catch (error) {
                console.error('Error initializing icons:', error);
            }
            
            // Hide loading screen if authentication screen is showing
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                const authScreen = document.getElementById('auth-screen');
                if (loadingScreen && authScreen && authScreen.style.display !== 'none') {
                    loadingScreen.style.display = 'none';
                }
            }, 500);
        });

        // ============================================
        // END AUTHENTICATION SYSTEM
        // ============================================

        // Global data storage
        let dashboardData = {
            portfolio: {},
            positions: [],
            signals: [],
            records: [],
            marketData: [],
            insights: []
        };

        // Pagination state
        let currentPage = 1;
        const recordsPerPage = 10;

        // API base URL - change this to your Flask server
        const API_BASE = window.location.origin.includes('localhost') ? 'http://localhost:5001' : window.location.origin;

        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour12: false,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
            });
            document.getElementById('current-time').textContent = timeString;
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        // Format percentage
        function formatPercent(value) {
            return (value >= 0 ? '+' : '') + value.toFixed(2) + '%';
        }

        // Sample data for demonstration
        const sampleData = {
            portfolio: {
                balance: 25430.75,
                change: 2.4,
                changeAmount: 620.50,
                todayPnL: 145.20,
                activePositions: 3,
                winRate: 73.2,
                totalTrades: 174
            },
            positions: [
                {
                    asset: 'EUR/USD',
                    direction: 'BUY',
                    entry: 1.0845,
                    current: 1.0872,
                    pnl: 85.50,
                    pnlPercent: 1.2,
                    size: 0.5,
                    stopLoss: 1.0795,
                    takeProfit: 1.0945
                },
                {
                    asset: 'BTC/USD',
                    direction: 'SELL',
                    entry: 45230,
                    current: 44850,
                    pnl: -190.00,
                    pnlPercent: -0.8,
                    size: 0.02,
                    stopLoss: 45800,
                    takeProfit: 43500
                },
                {
                    asset: 'GBP/JPY',
                    direction: 'BUY',
                    entry: 187.45,
                    current: 187.45,
                    pnl: 0,
                    pnlPercent: 0,
                    size: 0.3,
                    stopLoss: 186.50,
                    takeProfit: 189.50
                }
            ],
            signals: [
                {
                    asset: 'USD/JPY',
                    direction: 'BUY',
                    confidence: 89,
                    entry: 147.85,
                    stopLoss: 147.35,
                    takeProfit1: 148.85,
                    takeProfit2: 149.85,
                    category: 'asian',
                    analysis: 'Strong bullish momentum detected'
                },
                {
                    asset: 'ETH/USD',
                    direction: 'SELL',
                    confidence: 76,
                    entry: 3456.78,
                    stopLoss: 3520.78,
                    takeProfit1: 3356.78,
                    takeProfit2: 3256.78,
                    category: 'crypto',
                    analysis: 'Bearish divergence forming'
                },
                {
                    asset: 'AUD/USD',
                    direction: 'HOLD',
                    confidence: 62,
                    entry: 0.6589,
                    stopLoss: 0.6539,
                    takeProfit1: 0.6689,
                    takeProfit2: 0.6789,
                    category: 'major',
                    analysis: 'Waiting for clearer direction'
                }
            ],
            records: [
                { asset: 'EUR/USD', direction: 'BUY', strategy: 'Trend Following', entry: 1.0820, exit: 1.0855, pnl: 42.50, pips: 35, duration: '2h 15m', date: '2024-12-10' },
                { asset: 'BTC/USD', direction: 'SELL', strategy: 'Breakout', entry: 45500, exit: 44800, pnl: 140.00, pips: 700, duration: '4h 30m', date: '2024-12-09' },
                { asset: 'GBP/JPY', direction: 'BUY', strategy: 'Scalping', entry: 186.20, exit: 187.80, pnl: 48.00, pips: 160, duration: '45m', date: '2024-12-08' },
                { asset: 'USD/CHF', direction: 'SELL', strategy: 'Reversal', entry: 0.9150, exit: 0.9120, pnl: 36.00, pips: 30, duration: '1h 20m', date: '2024-12-07' },
                { asset: 'AUD/USD', direction: 'BUY', strategy: 'Momentum', entry: 0.6520, exit: 0.6490, pnl: -36.00, pips: -30, duration: '3h 10m', date: '2024-12-06' },
                { asset: 'USD/JPY', direction: 'BUY', strategy: 'Support Bounce', entry: 147.50, exit: 148.20, pnl: 70.00, pips: 70, duration: '1h 45m', date: '2024-12-05' },
                { asset: 'ETH/USD', direction: 'SELL', strategy: 'Resistance', entry: 3450, exit: 3420, pnl: 60.00, pips: 300, duration: '2h 30m', date: '2024-12-04' },
                { asset: 'NZD/USD', direction: 'BUY', strategy: 'Range Trade', entry: 0.6120, exit: 0.6150, pnl: 36.00, pips: 30, duration: '5h 15m', date: '2024-12-03' },
                { asset: 'EUR/GBP', direction: 'SELL', strategy: 'Breakout', entry: 0.8450, exit: 0.8480, pnl: -42.00, pips: -30, duration: '3h 45m', date: '2024-12-02' },
                { asset: 'XAU/USD', direction: 'BUY', strategy: 'Gold Trend', entry: 1950, exit: 1975, pnl: 125.00, pips: 250, duration: '6h 20m', date: '2024-12-01' }
            ],
            marketData: [
                { region: 'Asia', change: 2.4, status: 'bullish' },
                { region: 'Europe', change: -1.2, status: 'bearish' },
                { region: 'Americas', change: 1.8, status: 'bullish' },
                { region: 'Crypto', change: -3.1, status: 'volatile' }
            ],
            insights: [
                { type: 'market_regime', message: 'Current regime: Bull Market (87% confidence)', priority: 'high' },
                { type: 'risk', message: 'Portfolio risk within acceptable limits', priority: 'medium' },
                { type: 'opportunity', message: 'High probability setup in EUR/USD', priority: 'high' }
            ]
        };

        // Render current positions
        function renderPositions(positions) {
            const container = document.getElementById('current-positions');
            if (!positions || positions.length === 0) {
                container.innerHTML = '<p class="text-white/60 text-center py-4">No active positions</p>';
                return;
            }

            container.innerHTML = positions.map((pos, index) => {
                const pnlClass = pos.pnl >= 0 ? 'profit-text' : 'loss-text';
                const pnlPercentClass = pos.pnlPercent >= 0 ? 'profit-text' : 'loss-text';

                return `
                    <div class="glass-card rounded-xl p-5 border-l-4 ${pos.pnl >= 0 ? 'border-accent-green' : 'border-accent-red'} animate-fade-in metric-card" style="animation-delay: ${0.1 + index * 0.1}s">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="font-bold text-lg">${pos.asset}</h4>
                                <p class="text-sm text-white/70">${pos.direction} @ ${formatCurrency(pos.entry)}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold ${pnlClass}">${formatCurrency(pos.pnl)}</p>
                                <p class="text-sm ${pnlPercentClass} font-medium">(${formatPercent(pos.pnlPercent)})</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div class="glass-card rounded-lg p-3 bg-black/20">
                                <span class="text-white/60 block text-xs uppercase tracking-wide">Current</span>
                                <span class="font-mono font-semibold">${pos.asset.includes('JPY') ? pos.current.toFixed(2) : pos.asset.includes('BTC') ? formatCurrency(pos.current) : pos.current.toFixed(5)}</span>
                            </div>
                            <div class="glass-card rounded-lg p-3 bg-black/20">
                                <span class="text-accent-red block text-xs uppercase tracking-wide">Stop Loss</span>
                                <span class="font-mono font-semibold text-accent-red">${pos.asset.includes('JPY') ? pos.stopLoss.toFixed(2) : pos.asset.includes('BTC') ? formatCurrency(pos.stopLoss) : pos.stopLoss.toFixed(5)}</span>
                            </div>
                            <div class="glass-card rounded-lg p-3 bg-black/20">
                                <span class="text-accent-green block text-xs uppercase tracking-wide">Take Profit</span>
                                <span class="font-mono font-semibold text-accent-green">${pos.asset.includes('JPY') ? pos.takeProfit.toFixed(2) : pos.asset.includes('BTC') ? formatCurrency(pos.takeProfit) : pos.takeProfit.toFixed(5)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render live signals
        function renderSignals(signals, filter = 'all') {
            const container = document.getElementById('live-signals');
            let filteredSignals = signals;

            switch (filter) {
                case 'buy':
                    filteredSignals = signals.filter(s => s.direction === 'BUY');
                    break;
                case 'sell':
                    filteredSignals = signals.filter(s => s.direction === 'SELL');
                    break;
                case 'high-confidence':
                    filteredSignals = signals.filter(s => s.confidence >= 80);
                    break;
            }

            if (!filteredSignals || filteredSignals.length === 0) {
                container.innerHTML = '<p class="text-white/60 text-center py-4 col-span-full">No signals match filter</p>';
                return;
            }

            container.innerHTML = filteredSignals.map((signal, index) => {
                const categoryClass = `market-${signal.category}`;
                const directionClass = `signal-${signal.direction.toLowerCase()}`;

                return `
                    <div class="glass-card rounded-xl p-5 ${categoryClass} animate-fade-in metric-card" style="animation-delay: ${0.1 + index * 0.1}s">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="font-bold text-lg">${signal.asset}</h4>
                                <span class="px-3 py-1 rounded-lg text-sm font-bold ${directionClass} text-white shadow-lg">
                                    ${signal.direction}
                                </span>
                            </div>
                            <div class="text-right">
                                <span class="text-lg font-bold text-accent-teal">${signal.confidence}%</span>
                                <p class="text-xs text-white/60 uppercase tracking-wide">Confidence</p>
                            </div>
                        </div>
                        <div class="space-y-3 text-sm mb-4">
                            <div class="flex justify-between items-center glass-card rounded-lg p-3 bg-black/20">
                                <span class="text-white/70 font-medium">Entry:</span>
                                <span class="font-mono font-bold text-white">${signal.asset.includes('JPY') ? signal.entry.toFixed(2) : signal.asset.includes('BTC') ? formatCurrency(signal.entry) : signal.entry.toFixed(5)}</span>
                            </div>
                            <div class="flex justify-between items-center glass-card rounded-lg p-3 bg-black/20">
                                <span class="text-accent-red font-medium">Stop Loss:</span>
                                <span class="font-mono font-bold text-accent-red">${signal.asset.includes('JPY') ? signal.stopLoss.toFixed(2) : signal.asset.includes('BTC') ? formatCurrency(signal.stopLoss) : signal.stopLoss.toFixed(5)}</span>
                            </div>
                            <div class="flex justify-between items-center glass-card rounded-lg p-3 bg-black/20">
                                <span class="text-accent-green font-medium">Take Profit:</span>
                                <span class="font-mono font-bold text-accent-green">${signal.asset.includes('JPY') ? signal.takeProfit1.toFixed(2) : signal.asset.includes('BTC') ? formatCurrency(signal.takeProfit1) : signal.takeProfit1.toFixed(5)}</span>
                            </div>
                        </div>
                        <div class="glass-card rounded-lg p-3 bg-black/20">
                            <p class="text-sm text-white/80 italic">${signal.analysis}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render trading records with pagination
        function renderTradingRecords(records, filter = 'all', page = 1) {
            const container = document.getElementById('trading-records');

            // Apply filter
            let filteredRecords = records;
            const now = new Date();

            switch (filter) {
                case 'wins':
                    filteredRecords = records.filter(r => r.pnl > 0);
                    break;
                case 'losses':
                    filteredRecords = records.filter(r => r.pnl < 0);
                    break;
                case 'last-30':
                    filteredRecords = records.filter(r => {
                        const recordDate = new Date(r.date);
                        const diffTime = Math.abs(now - recordDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 30;
                    });
                    break;
                case 'last-7':
                    filteredRecords = records.filter(r => {
                        const recordDate = new Date(r.date);
                        const diffTime = Math.abs(now - recordDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 7;
                    });
                    break;
            }

            if (!filteredRecords || filteredRecords.length === 0) {
                container.innerHTML = '<tr><td colspan="9" class="text-center py-4 text-white/60">No trading records match filter</td></tr>';
                updatePaginationInfo(0, 0, 0);
                return;
            }

            // Calculate pagination
            const totalRecords = filteredRecords.length;
            const totalPages = Math.ceil(totalRecords / recordsPerPage);
            const startIndex = (page - 1) * recordsPerPage;
            const endIndex = startIndex + recordsPerPage;
            const pageRecords = filteredRecords.slice(startIndex, endIndex);

            // Update statistics
            updateTradingStatistics(filteredRecords);

            container.innerHTML = pageRecords.map(record => {
                const pnlClass = record.pnl >= 0 ? 'profit-text' : 'loss-text';

                return `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="py-3 font-medium">${record.asset}</td>
                        <td class="py-3">
                            <span class="px-2 py-1 rounded text-xs ${record.direction === 'BUY' ? 'signal-buy' : 'signal-sell'} text-white">
                                ${record.direction}
                            </span>
                        </td>
                        <td class="py-3 text-sm text-white/70">${record.strategy}</td>
                        <td class="py-3 text-right font-mono">${record.asset.includes('JPY') ? record.entry.toFixed(2) : record.asset.includes('BTC') || record.asset.includes('ETH') || record.asset.includes('XAU') ? formatCurrency(record.entry) : record.entry.toFixed(5)}</td>
                        <td class="py-3 text-right font-mono">${record.asset.includes('JPY') ? record.exit.toFixed(2) : record.asset.includes('BTC') || record.asset.includes('ETH') || record.asset.includes('XAU') ? formatCurrency(record.exit) : record.exit.toFixed(5)}</td>
                        <td class="py-3 text-right font-semibold ${pnlClass}">${formatCurrency(record.pnl)}</td>
                        <td class="py-3 text-right ${record.pips >= 0 ? 'profit-text' : 'loss-text'}">${record.pips > 0 ? '+' : ''}${record.pips}</td>
                        <td class="py-3 text-right text-white/60">${record.duration}</td>
                        <td class="py-3 text-right text-white/60">${record.date}</td>
                    </tr>
                `;
            }).join('');

            // Update pagination info
            updatePaginationInfo(totalRecords, page, totalPages);
        }

        // Update trading statistics
        function updateTradingStatistics(records) {
            const totalTrades = records.length;
            const winningTrades = records.filter(r => r.pnl > 0).length;
            const totalPnL = records.reduce((sum, r) => sum + r.pnl, 0);
            const avgTradeSize = totalTrades > 0 ? totalPnL / totalTrades : 0;
            const bestTrade = Math.max(...records.map(r => r.pnl));
            const worstTrade = Math.min(...records.map(r => r.pnl));

            document.getElementById('total-trades').textContent = totalTrades;
            document.getElementById('avg-trade-size').textContent = formatCurrency(Math.abs(avgTradeSize));
            document.getElementById('best-trade').textContent = formatCurrency(bestTrade);
            document.getElementById('worst-trade').textContent = formatCurrency(worstTrade);
        }

        // Update pagination info
        function updatePaginationInfo(totalRecords, currentPage, totalPages) {
            const startRecord = (currentPage - 1) * recordsPerPage + 1;
            const endRecord = Math.min(currentPage * recordsPerPage, totalRecords);

            document.getElementById('records-info').textContent = `Showing ${startRecord}-${endRecord} of ${totalRecords} trades`;
            document.getElementById('page-info').textContent = `Page ${currentPage} of ${totalPages}`;

            // Update pagination buttons
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
        }

        // Handle pagination
        function changePage(direction) {
            const totalPages = Math.ceil(dashboardData.records.length / recordsPerPage);
            if (direction === 'next' && currentPage < totalPages) {
                currentPage++;
            } else if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            }
            const filter = document.getElementById('records-filter').value;
            renderTradingRecords(dashboardData.records, filter, currentPage);
        }

        // Export trading records
        function exportRecords() {
            const records = dashboardData.records;
            const csvContent = [
                ['Asset', 'Direction', 'Strategy', 'Entry', 'Exit', 'P&L', 'Pips', 'Duration', 'Date'],
                ...records.map(r => [r.asset, r.direction, r.strategy, r.entry, r.exit, r.pnl, r.pips, r.duration, r.date])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trading_records_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Render market overview
        function renderMarketOverview(marketData) {
            const container = document.getElementById('market-overview');

            if (!marketData || marketData.length === 0) {
                container.innerHTML = '<p class="text-white/60 text-center py-4">No market data available</p>';
                return;
            }

            container.innerHTML = marketData.map((market, index) => {
                const changeClass = market.change >= 0 ? 'profit-text' : 'loss-text';
                const statusColor = market.status === 'bullish' ? 'accent-green' : market.status === 'bearish' ? 'accent-red' : 'accent-yellow';

                return `
                    <div class="flex items-center justify-between p-4 glass-card rounded-xl animate-fade-in metric-card" style="animation-delay: ${0.1 + index * 0.1}s">
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-${statusColor} rounded-full mr-4 animate-pulse-slow shadow-lg"></div>
                            <div>
                                <span class="font-bold text-lg">${market.region}</span>
                                <p class="text-sm text-white/60 capitalize">${market.status} Market</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-2xl font-bold ${changeClass}">${formatPercent(market.change)}</span>
                            <p class="text-xs text-white/60">24h Change</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render AI insights
        function renderAIInsights(insights) {
            const container = document.getElementById('ai-insights');

            if (!insights || insights.length === 0) {
                container.innerHTML = '<p class="text-white/60 text-center py-4">No AI insights available</p>';
                return;
            }

            container.innerHTML = insights.map((insight, index) => {
                const priorityColor = insight.priority === 'high' ? 'accent-yellow' : insight.priority === 'medium' ? 'accent-teal' : 'accent-cyan';
                const icon = insight.type === 'market_regime' ? 'radar' : insight.type === 'risk' ? 'shield' : 'lightbulb';
                const bgColor = insight.priority === 'high' ? 'rgba(245, 158, 11, 0.1)' : insight.priority === 'medium' ? 'rgba(59, 130, 246, 0.1)' : 'rgba(139, 92, 246, 0.1)';

                return `
                    <div class="p-4 glass-card rounded-xl border-l-4 border-${priorityColor} animate-fade-in metric-card" style="animation-delay: ${0.1 + index * 0.1}s; background: ${bgColor}">
                        <div class="flex items-start">
                            <div class="w-10 h-10 secondary-gradient rounded-lg flex items-center justify-center mr-3 animate-float" style="animation-delay: ${index * 0.5}s">
                                <i data-lucide="${icon}" class="w-5 h-5 text-${priorityColor}"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-white/90 leading-relaxed">${insight.message}</p>
                                <p class="text-xs text-white/60 mt-2 uppercase tracking-wide">${insight.priority} Priority</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update portfolio metrics
        function updatePortfolioMetrics(data) {
            document.getElementById('portfolio-balance').textContent = formatCurrency(data.balance);
            document.getElementById('balance-change').textContent = `${formatPercent(data.change)} (${formatCurrency(data.changeAmount)})`;
            document.getElementById('today-pnl').textContent = formatCurrency(data.todayPnL);
            document.getElementById('active-positions').textContent = data.activePositions;
            document.getElementById('win-rate').textContent = `${data.winRate.toFixed(1)}%`;
        }

        // Initialize performance chart
        function initPerformanceChart() {
            // Check if Chart.js is loaded and canvas exists
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                return;
            }

            const canvas = document.getElementById('performance-chart');
            if (!canvas) {
                console.error('Performance chart canvas not found');
                return;
            }

            // Destroy existing chart if it exists
            if (window.performanceChart) {
                window.performanceChart.destroy();
            }

            const ctx = canvas.getContext('2d');

            // Generate last 30 days of dates
            const dates = [];
            const portfolioValues = [];
            const startValue = 25000; // Starting portfolio value

            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

                // Simulate realistic portfolio growth with some volatility
                const baseGrowth = startValue * (1 + (i * 0.001)); // Gradual growth
                const volatility = (Math.random() - 0.5) * 0.02; // Â±1% daily volatility
                const dailyValue = baseGrowth * (1 + volatility);
                portfolioValues.push(Math.round(dailyValue));
            }

            window.performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Portfolio Value',
                        data: portfolioValues,
                        borderColor: 'rgba(20, 184, 166, 1)',
                        backgroundColor: 'rgba(20, 184, 166, 0.15)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        pointBackgroundColor: 'rgba(20, 184, 166, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    return 'Portfolio: $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                maxTicksLimit: 7
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'k';
                                },
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverRadius: 6
                        }
                    }
                }
            });
        }

        // Update performance chart with real data
        function updatePerformanceChart(records) {
            if (!window.performanceChart || !records || records.length === 0) {
                return;
            }

            // Calculate cumulative P&L over time
            const sortedRecords = records.sort((a, b) => new Date(a.date) - new Date(b.date));
            let cumulativePnL = 0;
            const dates = [];
            const values = [];

            sortedRecords.forEach((record, index) => {
                cumulativePnL += parseFloat(record.pnl);
                dates.push(new Date(record.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                values.push(25000 + cumulativePnL); // Starting balance + cumulative P&L
            });

            window.performanceChart.data.labels = dates;
            window.performanceChart.data.datasets[0].data = values;
            window.performanceChart.update();
        }

        // Fetch data from API
        async function fetchSignals() {
            try {
                const response = await fetch(`${API_BASE}/api/signals`);
                if (response.ok) {
                    const data = await response.json();
                    dashboardData.signals = data.signals;
                    renderSignals(data.signals, document.getElementById('signal-filter').value);
                } else {
                    console.log('Using mock signals data');
                    renderSignals(dashboardData.signals, document.getElementById('signal-filter').value);
                }
            } catch (error) {
                console.error('Failed to fetch signals, using existing data:', error);
                renderSignals(dashboardData.signals, document.getElementById('signal-filter').value);
            }
        }

        async function fetchPortfolio() {
            try {
                const response = await fetch(`${API_BASE}/api/portfolio`);
                if (response.ok) {
                    const data = await response.json();
                    dashboardData.portfolio = data;
                    updatePortfolioMetrics(data);
                } else {
                    console.log('Using mock portfolio data');
                }
            } catch (error) {
                console.error('Failed to fetch portfolio, using existing data:', error);
            }
        }

        async function fetchPositions() {
            try {
                const response = await fetch(`${API_BASE}/api/positions`);
                if (response.ok) {
                    const data = await response.json();
                    dashboardData.positions = data.positions;
                    renderPositions(data.positions);
                } else {
                    console.log('Using mock positions data');
                }
            } catch (error) {
                console.error('Failed to fetch positions, using existing data:', error);
                renderPositions(dashboardData.positions);
            }
        }

        async function fetchRecords() {
            try {
                const response = await fetch(`${API_BASE}/api/records?limit=100`);
                if (response.ok) {
                    const data = await response.json();
                    dashboardData.records = data.records;
                    renderTradingRecords(data.records, document.getElementById('records-filter').value, currentPage);
                    updatePerformanceChart(data.records);
                } else {
                    console.log('Using mock records data');
                    updatePerformanceChart(dashboardData.records);
                }
            } catch (error) {
                console.error('Failed to fetch records, using existing data:', error);
                renderTradingRecords(dashboardData.records, document.getElementById('records-filter').value, currentPage);
                updatePerformanceChart(dashboardData.records);
            }
        }

        async function fetchMarketOverview() {
            try {
                const response = await fetch(`${API_BASE}/api/market-overview`);
                if (response.ok) {
                    const data = await response.json();
                    dashboardData.marketData = data.marketData;
                    renderMarketOverview(data.marketData);
                } else {
                    console.log('Using mock market data');
                }
            } catch (error) {
                console.error('Failed to fetch market overview, using existing data:', error);
                renderMarketOverview(dashboardData.marketData);
            }
        }

        async function fetchAIInsights() {
            try {
                const response = await fetch(`${API_BASE}/api/ai-insights`);
                if (response.ok) {
                    const data = await response.json();
                    dashboardData.insights = data.insights;
                    renderAIInsights(data.insights);
                } else {
                    console.log('Using mock AI insights data');
                }
            } catch (error) {
                console.error('Failed to fetch AI insights, using existing data:', error);
                renderAIInsights(dashboardData.insights);
            }
        }

        // Refresh all data with smooth animations
        async function refreshAllData() {
            const refreshBtn = document.querySelector('button[onclick="refreshAllData()"]');
            const refreshIcon = document.getElementById('refresh-icon');

            // Add loading state with smooth transitions
            refreshBtn.disabled = true;
            refreshBtn.classList.add('loading-shimmer');
            refreshIcon.classList.add('animate-spin');

            document.getElementById('last-update').textContent = 'Refreshing...';
            document.getElementById('last-update').classList.add('text-accent-teal');
            document.getElementById('last-update').classList.remove('text-accent-green', 'text-accent-red');

            try {
                // Add a small delay for visual feedback
                await new Promise(resolve => setTimeout(resolve, 800));

                // Fetch fresh data from API
                await Promise.all([
                    fetchPortfolio(),
                    fetchPositions(),
                    fetchSignals(),
                    fetchRecords(),
                    fetchMarketOverview(),
                    fetchAIInsights()
                ]);

                // Update performance chart with latest data
                updatePerformanceChart(dashboardData.records);

                // Update local data with slight variations for demo
                dashboardData.positions.forEach(pos => {
                    const change = (Math.random() - 0.5) * 0.002;
                    pos.current = pos.entry * (1 + change);
                    pos.pnl = (pos.current - pos.entry) * pos.size * 100000;
                    pos.pnlPercent = ((pos.current - pos.entry) / pos.entry) * 100;
                });

                dashboardData.signals.forEach(signal => {
                    signal.confidence = Math.max(50, Math.min(95, signal.confidence + (Math.random() - 0.5) * 5));
                });

                document.getElementById('last-update').textContent = 'Just now';
                document.getElementById('last-update').classList.remove('text-accent-teal');
                document.getElementById('last-update').classList.add('text-accent-green');

            } catch (error) {
                console.error('Refresh failed:', error);
                document.getElementById('last-update').textContent = 'Refresh failed';
                document.getElementById('last-update').classList.remove('text-accent-teal');
                document.getElementById('last-update').classList.add('text-accent-red');
            } finally {
                // Remove loading state with smooth transition
                refreshBtn.disabled = false;
                refreshBtn.classList.remove('loading-shimmer');
                refreshIcon.classList.remove('animate-spin');

                // Reset status after 3 seconds
                setTimeout(() => {
                    document.getElementById('last-update').classList.remove('text-accent-green', 'text-accent-red');
                }, 3000);
            }
        }

        // Load initial data
        async function loadInitialData() {
            // Start with mock data as fallback
            dashboardData = { ...sampleData };

            console.log('Initializing performance chart...');
            initPerformanceChart();

            // Try to fetch real data from API
            console.log('Loading data from API...');
            await Promise.all([
                fetchPortfolio(),
                fetchPositions(),
                fetchSignals(),
                fetchRecords(),
                fetchMarketOverview(),
                fetchAIInsights()
            ]);

            // Update chart with loaded data
            updatePerformanceChart(dashboardData.records);

            console.log('Dashboard initialized with live data');

            // Hide loading screen and show main content with smooth transition
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                const mainContent = document.getElementById('main-content');
                const authScreen = document.getElementById('auth-screen');

                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    loadingScreen.style.transition = 'opacity 0.5s ease-out';

                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        // Only show main content if authenticated
                        if (isAuthenticated() && mainContent) {
                            mainContent.style.display = 'block';
                            mainContent.classList.add('animate-fade-in');
                        } else if (!isAuthenticated() && authScreen) {
                            authScreen.style.display = 'flex';
                        }
                    }, 500);
                }
            }, 1000);
        }

        // Event listeners
        document.getElementById('signal-filter').addEventListener('change', (e) => {
            renderSignals(dashboardData.signals, e.target.value);
        });

        document.getElementById('records-filter').addEventListener('change', (e) => {
            currentPage = 1; // Reset to first page when filtering
            renderTradingRecords(dashboardData.records, e.target.value, currentPage);
        });

        document.getElementById('prev-page').addEventListener('click', () => changePage('prev'));
        document.getElementById('next-page').addEventListener('click', () => changePage('next'));

        // Initialize dashboard (only when authenticated)
        function initializeDashboard() {
            if (!isAuthenticated()) {
                console.log('Not authenticated, skipping dashboard initialization');
                return;
            }

            try {
                updateTime();
                setInterval(updateTime, 1000);
                
                // Hide loading screen
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                loadInitialData().then(() => {
                    initPerformanceChart();
                }).catch(error => {
                    console.error('Error loading initial data:', error);
                    // Still try to show the dashboard with sample data
                    initPerformanceChart();
                });

                // Auto refresh every 30 seconds
                setInterval(refreshAllData, 30000);

                // Initialize icons after dynamic content is loaded
                setTimeout(() => {
                    lucide.createIcons();
                }, 100);
            } catch (error) {
                console.error('Error initializing dashboard:', error);
            }
        }

        // Initialize on page load if authenticated
        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                if (isAuthenticated()) {
                    initializeDashboard();
                }
            });
        } else {
            if (isAuthenticated()) {
                initializeDashboard();
            }
        }
    </script>
</body>
</html>
